"use strict";angular.module("clientApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl"}).otherwise({redirectTo:"/"})}]);var WindChill=function(){var a={},b={lat:62.1,"long":10.5};return a.init=function(a){b.lat=a.coords.latitude,b["long"]=a.coords.longitude,console.log("init.position: ",b)},a.position=b,a.handle_error=function(a){switch(a.code){case a.PERMISSION_DENIED:alert("Please allow the use of position data in order to use this app.");break;case a.POSITION_UNAVAILABLE:alert("Could not detect current position.");break;case a.TIMEOUT:alert("Unable to get position fix in resonable time. Timeout.");break;default:alert("Unknown error.")}},a.mapInit=function(){console.log("Map Init: ",b.lat,b["long"]);new ol.Map({target:"map",layers:[new ol.layer.Tile({source:new ol.source.MapQuest({layer:"sat"})})],view:new ol.View({center:ol.proj.fromLonLat([b["long"],b.lat]),zoom:15})})},a.weather_info=function(a){console.log("Weather Info: ",b.lat,b["long"]);var c="http://localhost:3000/api/weather/yr?lat="+b.lat+"&lon="+b["long"];$.get(c,function(b){var c=JSON.parse(b);console.log("weather",c),a(c)}).fail(function(){a({})})},a}();angular.module("clientApp").controller("MainCtrl",["$scope","$http",function(a,b){function c(a){var c="/api/weather/yr?lat="+a.latitude+"&lon="+a.longitude;b.get(c).success(function(b,c,d,f){var g=a.accuracy/2,h='<div><div class="effective"><span id="effective_value">'+b.windchill.value.toFixed(1)+'&deg;</span><br/><span class="effective-label">effective</span></div><div class="weather"><img src="http://api.yr.no/weatherapi/weathericon/1.1/?symbol='+b.weatherIcon.number+'&content_type=image/png"></div><div class="below"><div class="temperature"><span class="weather-label">Temp:</span><br/><span id="temp_value" class="weather-value">'+b.temperature.value+'&deg;</span></div><div class="windspeed"><span class="weather-label">Wind speed:</span><br/><span class="weather-value">'+b.windSpeed.value+" "+b.windSpeed.unit+'</span></div><div class="accuracy"><span>You are within '+g.toFixed(1)+" meters of this point.</span></div></div></div>",i=$(h),j={minWidth:"200",closeButton:!1,closeOnClick:!1,className:"temperature-box"};L.marker(a.latlng).addTo(e).bindPopup(i[0],j).openPopup(),L.circle(a.latlng,g).addTo(e)})}function d(a){alert(a.message)}var e=L.map("map");new L.TileLayer.WMS("http://opencache.statkart.no/gatekeeper/gk/gk.open",{layers:"matrikkel_bakgrunn",format:"image/png",transparent:!1,version:"1.0",attribution:"Kartverket"}).addTo(e),L.tileLayer("http://{s}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png",{attribution:"&copy; OpenCycleMap",opacity:.5}).addTo(e),e.locate({setView:!0,maxZoom:16}),e.on("locationfound",c),e.on("locationerror",d)}]),angular.module("clientApp").controller("AboutCtrl",["$scope",function(a){a.position={lat:61.2,"long":10.1},navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){var c=b.coords.latitude,d=b.coords.longitude;a.$apply(function(){a.position.lat=c,a.position["long"]=d})}),console.log("Scope: ",a)}]);
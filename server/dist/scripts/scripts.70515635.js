"use strict";angular.module("windchillApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ui-leaflet"]).config(["$locationProvider",function(a){a.html5Mode(!0)}]);var WindChill=function(){var a={},b={lat:62.1,"long":10.5};return a.init=function(a){b.lat=a.coords.latitude,b["long"]=a.coords.longitude,console.log("init.position: ",b)},a.position=b,a.handle_error=function(a){switch(a.code){case a.PERMISSION_DENIED:alert("Please allow the use of position data in order to use this app.");break;case a.POSITION_UNAVAILABLE:alert("Could not detect current position.");break;case a.TIMEOUT:alert("Unable to get position fix in resonable time. Timeout.");break;default:alert("Unknown error.")}},a.mapInit=function(){console.log("Map Init: ",b.lat,b["long"]);new ol.Map({target:"map",layers:[new ol.layer.Tile({source:new ol.source.MapQuest({layer:"sat"})})],view:new ol.View({center:ol.proj.fromLonLat([b["long"],b.lat]),zoom:15})})},a.weather_info=function(a){console.log("Weather Info: ",b.lat,b["long"]);var c="http://localhost:3000/api/weather/yr?lat="+b.lat+"&lon="+b["long"];$.get(c,function(b){var c=JSON.parse(b);console.log("weather",c),a(c)}).fail(function(){a({})})},a}();angular.module("windchillApp").controller("MainCtrl",["$scope","$http","leafletData","WeatherService",function(a,b,c,d){function e(b,c){angular.extend(a,{position:b,center:{lat:b.lat,lng:b.lng,zoom:c},markers:{m1:{lat:b.lat,lng:b.lng,focus:!0,message:"<div ng-include src=\"'views/popup.html'\"></div>",draggable:!1}}})}c.getMap().then(function(a){var b=new L.TileLayer.WMS("https://opencache.statkart.no/gatekeeper/gk/gk.open",{layers:"topo2",format:"image/png",transparent:!1,version:"1.0",attribution:"Kartverket"});b.addTo(a),a.locate({setView:!0,maxZoom:16})});var f={lat:63.43048590647616,lng:10.395147800445558};angular.extend(a,{text:"Initial position ",events:{}}),d.position=f,e(f,12),a.$on("leafletDirectiveMap.locationfound",function(a,b){var c=b.leafletEvent;d.position=c.latlng,e(c.latlng,16)}),a.$on("leafletDirectiveMap.locationerror",function(a,b){var d=b.leafletEvent;c.getMap().then(function(a){L.marker(d.latlng).addTo(a).bindPopup("<b>Failed to get location.</b>")})}),a.$on("leafletDirectiveMap.click",function(a,b){var f=b.leafletEvent;d.position=f.latlng,e(f.latlng,16),c.getMarkers().then(function(a){a.m1.openPopup()})})}]),angular.module("windchillApp").controller("WeatherCtrl",["$scope","$http","leafletData","WeatherService",function(a,b,c,d){d.currentPositionWeather().success(function(b){angular.extend(a,{weather:b,position:d.position})})}]),angular.module("windchillApp").service("WeatherService",["$http",function(a){function b(a){return"/api/weather/yr?lat="+a.lat+"&lon="+a.lng}this.currentPositionWeather=function(){return a.get(b(this.position))}}]);